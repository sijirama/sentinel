---
---

<script>

  interface StatusData {
    status: number;
    time: string;
    msg: string;
    ping: number;
  }

  interface ResponseData {
    heartbeatList: {
      [key: string]: StatusData[];
    };
    uptimeList: {
      [key: string]: number;
    };
  }

  let statusData: ResponseData | null = null;

  function updateUI(data: ResponseData) {
    statusData = data;
    const statusElement = document.getElementById('status');
    if (statusElement) {
      statusElement.textContent = JSON.stringify(data, null, 2);
    }
  }

  function connectSSE() {
    const eventSource = new EventSource('http://localhost:8080/status');

    eventSource.onmessage = (event) => {
      const data = JSON.parse(event.data) as ResponseData;
      updateUI(data);
    };

    eventSource.onerror = (error) => {
      console.error('SSE Error:', error);
      eventSource.close();
      setTimeout(connectSSE, 5000); // Reconnect after 5 seconds
    };
  }

  // Connect to SSE when the component mounts
  if (typeof window !== 'undefined') {
    connectSSE();
  }
</script>

<div>
  <h1>Status Page</h1>
  <pre id="status">Waiting for status data...</pre>
</div>

<style>
  pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 5px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
</style>
